# æ•°æ®æ¥æºåˆ†ææŠ¥å‘Š

## é—®é¢˜1: é¢„æµ‹æ•°æ®æ˜¯æ€ä¹ˆå¾—åˆ°çš„ï¼Ÿ

### å›ç­”ï¼š

ç›®å‰**é¢„æµ‹æ•°æ®ï¼ˆæœªæ¥7å¤©ï¼‰æ˜¯ä½¿ç”¨ç®—æ³•ç”Ÿæˆçš„æ¨¡æ‹Ÿæ•°æ®**ï¼Œä¸æ˜¯æ¥è‡ªçœŸå®APIã€‚

#### é¢„æµ‹æ•°æ®æ¥æºï¼š

1. **å‡ºè¡Œå»ºè®®ï¼ˆTravel Recommendationsï¼‰çš„æœªæ¥7å¤©é¢„æµ‹**:
   - **ä½ç½®**: `backend/app/db/seed_nyc_data.py` çš„ `generate_travel_recommendation()` å‡½æ•°
   - **ç”Ÿæˆæ–¹å¼**: ä½¿ç”¨æ•°å­¦ç®—æ³•ï¼ˆsin/coså‡½æ•° + éšæœºæ•°ï¼‰ç”Ÿæˆ
   - **æ—¶é—´ç»´åº¦**: æœªæ¥7å¤©ï¼ˆä»ä»Šå¤©å¼€å§‹çš„æœªæ¥7å¤©ï¼‰
   - **æ•°æ®**: risk_score, recommendation_level, adviceç­‰

2. **æ°”å€™å›¾è¡¨ï¼ˆClimate Chartsï¼‰çš„æœªæ¥7å¤©é¢„æµ‹**:
   - **ä½ç½®**: `frontend/src/pages/NYC/ClimateCharts.tsx` çš„ `generateFutureData()` å‡½æ•°
   - **ç”Ÿæˆæ–¹å¼**: åŸºäºå½“å‰æ•°æ® + æ•°å­¦å˜åŒ–ï¼ˆsin/coså‡½æ•°ï¼‰ç”Ÿæˆ
   - **æ—¶é—´ç»´åº¦**: æœªæ¥7å¤©
   - **æ•°æ®**: AQI, æ¸©åº¦, æ¹¿åº¦, é£é€Ÿ, PM2.5ç­‰

#### æ€»ç»“ï¼š
- âŒ **ä¸æ˜¯ä»çœŸå®APIè·å–é¢„æµ‹æ•°æ®**
- âœ… **æ˜¯åŸºäºç®—æ³•ç”Ÿæˆçš„æ¨¡æ‹Ÿé¢„æµ‹æ•°æ®**
- ğŸ“ **ç”¨äºå±•ç¤ºå’Œæ¼”ç¤ºç›®çš„**

---

## é—®é¢˜2: ä¸¤ä¸ªAPIæŠ“å–åˆ°çš„æ•°æ®æ—¶é—´ç»´åº¦æ˜¯ä»€ä¹ˆï¼Ÿ

### å›ç­”ï¼š

ä¸¤ä¸ªAPIéƒ½åªèƒ½è·å–**å½“å‰ï¼ˆCurrent/Real-timeï¼‰æ•°æ®**ï¼Œ**ä¸èƒ½è·å–æœªæ¥é¢„æµ‹æ•°æ®**ã€‚

#### OpenWeatherMap API:

- **ç«¯ç‚¹**: `/data/2.5/weather` (Current Weather)
- **æ—¶é—´ç»´åº¦**: **å½“å‰å®æ—¶æ•°æ®** (Current/Real-time)
- **æ•°æ®èŒƒå›´**: 
  - å½“å‰æ—¶åˆ»çš„å¤©æ°”æ•°æ®
  - ä¸æ˜¯é¢„æµ‹æ•°æ®
  - ä¸æ˜¯å†å²æ•°æ®ï¼ˆå¯ä»¥è·å–å†å²ï¼Œä½†ä¸æ˜¯æˆ‘ä»¬ç”¨çš„ç«¯ç‚¹ï¼‰

#### AirNow API:

- **ç«¯ç‚¹**: `/aq/observation/zipCode/current/` (Current Observations)
- **æ—¶é—´ç»´åº¦**: **å½“å‰å®æ—¶æ•°æ®** (Current/Real-time)
- **æ•°æ®èŒƒå›´**:
  - å½“å‰æ—¶åˆ»çš„ç©ºæ°”è´¨é‡æ•°æ®
  - å¯ä»¥æŸ¥è¯¢å†å²æŸä¸€å¤©çš„æ•°æ®ï¼ˆé€šè¿‡dateå‚æ•°ï¼‰
  - **ä¸èƒ½è·å–æœªæ¥é¢„æµ‹æ•°æ®**

#### æ€»ç»“ï¼š

```
APIæ•°æ®æ—¶é—´ç»´åº¦ï¼š

OpenWeatherMap:
  âœ… å½“å‰å®æ—¶æ•°æ® (Current Weather)
  âŒ ä¸èƒ½è·å–æœªæ¥é¢„æµ‹

AirNow:
  âœ… å½“å‰å®æ—¶æ•°æ® (Current Observations)
  âœ… å¯ä»¥è·å–å†å²æŸä¸€å¤©çš„æ•°æ® (é€šè¿‡dateå‚æ•°)
  âŒ ä¸èƒ½è·å–æœªæ¥é¢„æµ‹
```

---

## é—®é¢˜3: risk_scoreæ˜¯æ€ä¹ˆè®¡ç®—çš„ï¼Ÿ

### å›ç­”ï¼š

`risk_score`æ˜¯åŸºäº**CHRIï¼ˆComprehensive Health Risk Indexï¼‰**è®¡ç®—çš„ï¼Œä½¿ç”¨ç®—æ³•ç”Ÿæˆã€‚

#### è®¡ç®—æµç¨‹ï¼š

1. **é¦–å…ˆè®¡ç®—CHRIï¼ˆç»¼åˆå¥åº·é£é™©æŒ‡æ•°ï¼‰**:
   ```python
   # åŸºç¡€å› å­
   base_chri = 35 + (zip_code[0] % 40) + (day_offset * 1.5) + 
               base_variation + random_variation + weekend_effect
   
   # å„å› å­åŠ æƒç»„åˆ
   comprehensive_health_risk_index = 
       (air_quality_factor * 0.35) +
       (weather_factor * 0.25) +
       (pollen_factor * 0.20) +
       (pollution_factor * 0.20) +
       base_variation * 0.1
   
   chri = max(0, min(150, comprehensive_health_risk_index))
   ```

2. **æ ¹æ®CHRIç¡®å®šrecommendation_level**:
   - `chri <= 40` â†’ 'safe'
   - `chri <= 70` â†’ 'moderate'
   - `chri <= 100` â†’ 'caution'
   - `chri > 100` â†’ 'avoid'

3. **æ ¹æ®levelè®¡ç®—risk_score**:
   ```python
   if chri <= 40:
       risk_score = 15 + (zip_code[0] % 15) + random.random() * 10
       # èŒƒå›´: 15-40
   elif chri <= 70:
       risk_score = 35 + (zip_code[0] % 20) + random.random() * 15
       # èŒƒå›´: 35-70
   elif chri <= 100:
       risk_score = 55 + (zip_code[0] % 25) + random.random() * 15
       # èŒƒå›´: 55-95
   else:
       risk_score = 75 + (zip_code[0] % 20) + random.random() * 10
       # èŒƒå›´: 75-100
   ```

#### å…³é”®ç‚¹ï¼š

- âœ… **ä¸æ˜¯åŸºäºçœŸå®APIæ•°æ®è®¡ç®—**
- âœ… **æ˜¯åŸºäºç®—æ³•æ¨¡æ‹Ÿè®¡ç®—**
- âœ… **ä½¿ç”¨sin/coså‡½æ•°æ¨¡æ‹Ÿå˜åŒ–è¶‹åŠ¿**
- âœ… **åŠ å…¥éšæœºæ€§å’Œå‘¨æœ«æ•ˆåº”**

#### è®¡ç®—å…¬å¼æ€»ç»“ï¼š

```
risk_score = f(CHRI)
å…¶ä¸­:
  CHRI = åŠ æƒç»„åˆ(ç©ºæ°”è´¨é‡å› å­, å¤©æ°”å› å­, èŠ±ç²‰å› å­, æ±¡æŸ“å› å­)
  recommendation_level = g(CHRI)
  risk_score = h(level) + éšæœºå˜åŒ–
```

---

## ğŸ“Š å®Œæ•´æ•°æ®æµç¨‹å›¾

```
çœŸå®APIæ•°æ® (å½“å‰æ—¶åˆ»):
  OpenWeatherMap â†’ å½“å‰å¤©æ°”æ•°æ®
  AirNow â†’ å½“å‰ç©ºæ°”è´¨é‡æ•°æ®
         â†“
  ä¿å­˜åˆ°æ•°æ®åº“ (NYCClimateDataè¡¨)
         â†“
  å‰ç«¯æ˜¾ç¤º (å½“å‰æ•°æ®)

é¢„æµ‹æ•°æ® (æœªæ¥7å¤©):
  ç®—æ³•ç”Ÿæˆ â†’ Travel Recommendations (7å¤©é¢„æµ‹)
  ç®—æ³•ç”Ÿæˆ â†’ Climate Charts (7å¤©é¢„æµ‹)
         â†“
  å‰ç«¯æ˜¾ç¤º (æœªæ¥é¢„æµ‹)
```

---

## âš ï¸ é‡è¦è¯´æ˜

1. **å½“å‰æ•°æ®**: æ¥è‡ªçœŸå®API âœ…
2. **é¢„æµ‹æ•°æ®**: ç®—æ³•ç”Ÿæˆï¼Œä¸æ˜¯çœŸå®APIé¢„æµ‹ âŒ
3. **risk_score**: ç®—æ³•è®¡ç®—ï¼Œä¸æ˜¯åŸºäºçœŸå®é¢„æµ‹æ•°æ® âŒ

---

## ğŸ”„ æ”¹è¿›å»ºè®®

å¦‚æœæƒ³ä½¿ç”¨çœŸå®é¢„æµ‹æ•°æ®ï¼š

1. **OpenWeatherMap Forecast API**: å¯ä»¥ä½¿ç”¨ `/data/2.5/forecast` ç«¯ç‚¹è·å–5å¤©é¢„æµ‹
2. **AirNow Forecast API**: å¯ä»¥è·å–ç©ºæ°”è´¨é‡é¢„æµ‹
3. **é›†æˆçœŸå®é¢„æµ‹API**: éœ€è¦ä¿®æ”¹ä»£ç ä»¥ä½¿ç”¨é¢„æµ‹ç«¯ç‚¹

