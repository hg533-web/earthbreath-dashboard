# æ•°æ®æ¥æºä¸è®¡ç®—æ–¹å¼è¯¦ç»†åˆ†æ

## é—®é¢˜1: é¢„æµ‹æ•°æ®æ˜¯æ€ä¹ˆå¾—åˆ°çš„ï¼Ÿ

### å›ç­”ï¼š

ç›®å‰**é¢„æµ‹æ•°æ®ï¼ˆæœªæ¥7å¤©ï¼‰éƒ½æ˜¯ä½¿ç”¨ç®—æ³•ç”Ÿæˆçš„æ¨¡æ‹Ÿæ•°æ®**ï¼Œ**ä¸æ˜¯æ¥è‡ªçœŸå®APIçš„é¢„æµ‹**ã€‚

#### ğŸ“ é¢„æµ‹æ•°æ®æ¥æºä½ç½®ï¼š

1. **å‡ºè¡Œå»ºè®®ï¼ˆTravel Recommendationsï¼‰çš„7å¤©é¢„æµ‹**:
   - **ä»£ç ä½ç½®**: `backend/app/db/seed_nyc_data.py` â†’ `generate_travel_recommendation()` å‡½æ•°
   - **ç”Ÿæˆæ–¹å¼**: 
     - ä½¿ç”¨æ•°å­¦ç®—æ³•ï¼ˆsin/coså‡½æ•°æ¨¡æ‹Ÿå‘¨æœŸæ€§å˜åŒ–ï¼‰
     - åŠ å…¥éšæœºå˜åŒ– (`random.random()`)
     - åŠ å…¥å‘¨æœ«æ•ˆåº”
     - åŸºäºzip codeçš„hashå€¼ç”Ÿæˆä¸åŒæ•°æ®
   - **æ—¶é—´ç»´åº¦**: æœªæ¥7å¤©ï¼ˆä»ä»Šå¤©å¼€å§‹ï¼‰
   - **æ•°æ®å†…å®¹**: risk_score, recommendation_level, overall_message, general_adviceç­‰

2. **æ°”å€™å›¾è¡¨ï¼ˆClimate Chartsï¼‰çš„æœªæ¥7å¤©é¢„æµ‹**:
   - **ä»£ç ä½ç½®**: `frontend/src/pages/NYC/ClimateCharts.tsx` â†’ `generateFutureData()` å‡½æ•°
   - **ç”Ÿæˆæ–¹å¼**: 
     - åŸºäºå½“å‰çœŸå®æ•°æ® + æ•°å­¦å˜åŒ–ï¼ˆsin/coså‡½æ•°ï¼‰
     - åœ¨å½“å‰å€¼åŸºç¡€ä¸ŠåŠ å‡variation
   - **æ—¶é—´ç»´åº¦**: æœªæ¥7å¤©
   - **æ•°æ®å†…å®¹**: AQI, æ¸©åº¦, æ¹¿åº¦, é£é€Ÿ, PM2.5ç­‰

#### âš ï¸ é‡è¦è¯´æ˜ï¼š
- âŒ **ä¸æ˜¯ä»çœŸå®APIè·å–é¢„æµ‹æ•°æ®**
- âœ… **æ˜¯åŸºäºç®—æ³•ç”Ÿæˆçš„æ¨¡æ‹Ÿé¢„æµ‹æ•°æ®**
- ğŸ“ **OpenWeatherMapå’ŒAirNow APIéƒ½ä¸æä¾›æœªæ¥é¢„æµ‹æ•°æ®**ï¼ˆè¯¦è§é—®é¢˜2ï¼‰

---

## é—®é¢˜2: ä¸¤ä¸ªAPIæŠ“å–åˆ°çš„æ•°æ®æ—¶é—´ç»´åº¦æ˜¯ä»€ä¹ˆï¼Ÿ

### å›ç­”ï¼š

ä¸¤ä¸ªAPIéƒ½åªèƒ½è·å–**å½“å‰ï¼ˆCurrent/Real-timeï¼‰æ•°æ®**æˆ–**å†å²æ•°æ®**ï¼Œ**ä¸èƒ½è·å–æœªæ¥é¢„æµ‹æ•°æ®**ã€‚

### OpenWeatherMap API:

**ç«¯ç‚¹**: `/data/2.5/weather` (Current Weather Data)

**æ—¶é—´ç»´åº¦**: 
- âœ… **å½“å‰å®æ—¶æ•°æ®** (Current/Real-time Weather)
- âŒ **ä¸èƒ½è·å–æœªæ¥é¢„æµ‹**ï¼ˆéœ€è¦ä½¿ç”¨forecastç«¯ç‚¹ï¼Œä½†æˆ‘ä»¬æ²¡ç”¨ï¼‰
- âŒ **ä¸èƒ½è·å–å†å²æ•°æ®**ï¼ˆéœ€è¦ä½¿ç”¨å…¶ä»–ç«¯ç‚¹ï¼‰

**æ•°æ®ç‰¹æ€§**:
- è¿”å›çš„æ˜¯è°ƒç”¨æ—¶åˆ»çš„å½“å‰å¤©æ°”
- æ•°æ®å®æ—¶æ›´æ–°
- æ²¡æœ‰æ—¶é—´åºåˆ—

**ä»£ç ä½ç½®**: `backend/app/services/weather_api.py` â†’ `get_weather_data()`

### AirNow API:

**ç«¯ç‚¹**: `/aq/observation/zipCode/current/` (Current Observations)

**æ—¶é—´ç»´åº¦**: 
- âœ… **å½“å‰å®æ—¶æ•°æ®** (Current Observations) - é»˜è®¤ä»Šå¤©
- âœ… **å¯ä»¥è·å–å†å²æŸä¸€å¤©çš„æ•°æ®** (é€šè¿‡dateå‚æ•°ä¼ å…¥å†å²æ—¥æœŸ)
- âŒ **ä¸èƒ½è·å–æœªæ¥é¢„æµ‹**ï¼ˆAPIä¸æä¾›é¢„æµ‹åŠŸèƒ½ï¼‰

**æ•°æ®ç‰¹æ€§**:
- é»˜è®¤è¿”å›ä»Šå¤©çš„æ•°æ®
- å¯ä»¥æŸ¥è¯¢å†å²æ—¥æœŸï¼ˆå¦‚2025-12-01ï¼‰
- ä¸æ”¯æŒæŸ¥è¯¢æœªæ¥æ—¥æœŸ

**ä»£ç ä½ç½®**: `backend/app/services/weather_api.py` â†’ `get_air_quality_data()`

### æ€»ç»“ï¼š

```
æ•°æ®æ—¶é—´ç»´åº¦å¯¹æ¯”ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   API           â”‚   å½“å‰æ•°æ®   â”‚   å†å²æ•°æ®   â”‚   æœªæ¥é¢„æµ‹   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ OpenWeatherMap  â”‚     âœ…       â”‚     âŒ       â”‚     âŒ       â”‚
â”‚ AirNow          â”‚     âœ…       â”‚     âœ…       â”‚     âŒ       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ³¨æ„ï¼šä¸¤ä¸ªAPIéƒ½ä¸æä¾›æœªæ¥é¢„æµ‹æ•°æ®ï¼
```

---

## é—®é¢˜3: risk_scoreæ˜¯æ€ä¹ˆè®¡ç®—çš„ï¼Ÿ

### å›ç­”ï¼š

`risk_score`æ˜¯åŸºäº**ç®—æ³•ç”Ÿæˆçš„ç»¼åˆå¥åº·é£é™©æŒ‡æ•°ï¼ˆCHRIï¼‰**è®¡ç®—çš„ï¼Œä½¿ç”¨æ•°å­¦æ¨¡å‹æ¨¡æ‹Ÿã€‚

### è¯¦ç»†è®¡ç®—æµç¨‹ï¼š

#### æ­¥éª¤1: è®¡ç®—åŸºç¡€å› å­

```python
# åŸºç¡€å˜åŒ–ï¼ˆä½¿ç”¨sin/coså‡½æ•°æ¨¡æ‹Ÿå‘¨æœŸæ€§ï¼‰
base_variation = sin(day_offset * 0.8) * 15 + cos(day_offset * 1.2) * 10

# éšæœºå˜åŒ–
random_variation = (random() - 0.5) * 25  # -12.5 åˆ° +12.5

# å‘¨æœ«æ•ˆåº”
weekend_effect = -5 if weekend else 3
```

#### æ­¥éª¤2: è®¡ç®—å„é¡¹å› å­

```python
# ç©ºæ°”è´¨é‡å› å­
air_quality_factor = 30 + (zip_code[0] % 35) + (day_offset * 1.2) + sin(day_offset) * 10

# å¤©æ°”å› å­
weather_factor = 25 + (zip_code[1] % 30) + cos(day_offset * 0.7) * 8

# èŠ±ç²‰å› å­
pollen_factor = 20 + (zip_code[2] % 25) + sin(day_offset * 1.5) * 6

# æ±¡æŸ“å› å­
pollution_factor = 15 + (zip_code[3] % 20) + cos(day_offset * 1.1) * 5
```

#### æ­¥éª¤3: è®¡ç®—ç»¼åˆå¥åº·é£é™©æŒ‡æ•°ï¼ˆCHRIï¼‰

```python
comprehensive_health_risk_index = 
    (air_quality_factor * 0.35) +      # ç©ºæ°”è´¨é‡æƒé‡35%
    (weather_factor * 0.25) +           # å¤©æ°”æƒé‡25%
    (pollen_factor * 0.20) +            # èŠ±ç²‰æƒé‡20%
    (pollution_factor * 0.20) +         # æ±¡æŸ“æƒé‡20%
    base_variation * 0.1                # åŸºç¡€å˜åŒ–æƒé‡10%

chri = max(0, min(150, comprehensive_health_risk_index))  # é™åˆ¶åœ¨0-150èŒƒå›´
```

#### æ­¥éª¤4: æ ¹æ®CHRIç¡®å®šé£é™©ç­‰çº§

```python
if chri <= 40:
    level = 'safe'
elif chri <= 70:
    level = 'moderate'
elif chri <= 100:
    level = 'caution'
else:
    level = 'avoid'
```

#### æ­¥éª¤5: æ ¹æ®levelè®¡ç®—risk_score

```python
if level == 'safe':  # chri <= 40
    risk_score = 15 + (zip_code[0] % 15) + random() * 10
    # èŒƒå›´: çº¦ 15-40
    
elif level == 'moderate':  # 40 < chri <= 70
    risk_score = 35 + (zip_code[0] % 20) + random() * 15
    # èŒƒå›´: çº¦ 35-70
    
elif level == 'caution':  # 70 < chri <= 100
    risk_score = 55 + (zip_code[0] % 25) + random() * 15
    # èŒƒå›´: çº¦ 55-95
    
else:  # level == 'avoid', chri > 100
    risk_score = 75 + (zip_code[0] % 20) + random() * 10
    # èŒƒå›´: çº¦ 75-100
```

### å…³é”®ç‚¹ï¼š

1. âœ… **ä¸æ˜¯åŸºäºçœŸå®APIæ•°æ®è®¡ç®—**
2. âœ… **æ˜¯å®Œå…¨åŸºäºç®—æ³•æ¨¡æ‹Ÿ**
3. âœ… **ä½¿ç”¨æ•°å­¦å‡½æ•°ï¼ˆsin/cosï¼‰æ¨¡æ‹Ÿå˜åŒ–è¶‹åŠ¿**
4. âœ… **åŠ å…¥éšæœºæ€§å’Œå‘¨æœŸæ€§å˜åŒ–**
5. âœ… **è€ƒè™‘å‘¨æœ«æ•ˆåº”**

### è®¡ç®—å…¬å¼æ€»ç»“ï¼š

```
risk_score = f(level)
å…¶ä¸­:
  level = g(CHRI)
  CHRI = åŠ æƒç»„åˆ(
    ç©ºæ°”è´¨é‡å› å­(35%) +
    å¤©æ°”å› å­(25%) +
    èŠ±ç²‰å› å­(20%) +
    æ±¡æŸ“å› å­(20%) +
    åŸºç¡€å˜åŒ–(10%)
  )
```

### risk_scoreèŒƒå›´ï¼š

- **Safe**: 15-40
- **Moderate**: 35-70
- **Caution**: 55-95
- **Avoid**: 75-100

---

## ğŸ“Š å®Œæ•´æ•°æ®æµç¨‹å›¾

```
å½“å‰æ•°æ®ï¼ˆçœŸå®APIï¼‰:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  OpenWeatherMap API (Current)       â”‚ â†’ å½“å‰å¤©æ°”æ•°æ®
  â”‚  AirNow API (Current/Historical)    â”‚ â†’ å½“å‰/å†å²ç©ºæ°”è´¨é‡
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
          ä¿å­˜åˆ°æ•°æ®åº“ (NYCClimateData)
                    â†“
              å‰ç«¯æ˜¾ç¤ºå½“å‰æ•°æ®

é¢„æµ‹æ•°æ®ï¼ˆç®—æ³•ç”Ÿæˆï¼‰:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  generate_travel_recommendation()   â”‚ â†’ 7å¤©å‡ºè¡Œå»ºè®®é¢„æµ‹
  â”‚  generateFutureData() (å‰ç«¯)        â”‚ â†’ 7å¤©æ°”å€™é¢„æµ‹å›¾è¡¨
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
              å‰ç«¯æ˜¾ç¤ºé¢„æµ‹æ•°æ®
```

---

## âš ï¸ é‡è¦æ€»ç»“

1. **å½“å‰æ•°æ®**: âœ… æ¥è‡ªçœŸå®APIï¼ˆOpenWeatherMap + AirNowï¼‰
2. **é¢„æµ‹æ•°æ®**: âŒ ç®—æ³•ç”Ÿæˆï¼Œä¸æ˜¯çœŸå®APIé¢„æµ‹
3. **risk_score**: âŒ åŸºäºç®—æ³•è®¡ç®—ï¼Œä¸åŸºäºçœŸå®é¢„æµ‹æ•°æ®
4. **APIæ—¶é—´ç»´åº¦**: åªèƒ½è·å–å½“å‰å’Œå†å²æ•°æ®ï¼Œä¸èƒ½è·å–æœªæ¥é¢„æµ‹

---

## ğŸ”„ æ”¹è¿›å»ºè®®

å¦‚æœæƒ³ä½¿ç”¨çœŸå®é¢„æµ‹æ•°æ®ï¼š

1. **OpenWeatherMap Forecast API**: 
   - ç«¯ç‚¹: `/data/2.5/forecast`
   - æä¾›: 5å¤©å¤©æ°”é¢„æµ‹
   - éœ€è¦: ä¿®æ”¹ä»£ç ä½¿ç”¨forecastç«¯ç‚¹

2. **OpenWeatherMap Air Pollution Forecast**:
   - ç«¯ç‚¹: `/data/2.5/air_pollution/forecast`
   - æä¾›: ç©ºæ°”è´¨é‡é¢„æµ‹
   - éœ€è¦: ä»˜è´¹è®¢é˜…

3. **é›†æˆçœŸå®é¢„æµ‹API**: éœ€è¦ä¿®æ”¹ä»£ç ä»¥ä½¿ç”¨é¢„æµ‹ç«¯ç‚¹æ›¿ä»£ç®—æ³•ç”Ÿæˆ

